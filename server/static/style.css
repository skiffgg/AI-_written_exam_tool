/* =====================================================================
   Global Theme Variables
   ===================================================================== */
:root {
    --primary-color: #4a6baf;
    --primary-light: #7a97d5;
    --primary-dark: #2a4a8f;
    --accent-color: #ff7043;
    --text-color: #333333;
    --light-text: #555555;
    --bg-color: #f4f7f6;
    --card-bg: #ffffff;
    --border-radius: 8px;
    --shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    --transition: all 0.2s ease-in-out;
    --font-family-sans-serif: 'Roboto', 'Microsoft YaHei', Arial, sans-serif;
    --font-family-monospace: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    --primary-color-rgb: 74, 107, 175;
}

/* =====================================================================
   Reset & Base Layout
   ===================================================================== */
*{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;height:100%}
body{font-family:var(--font-family-sans-serif);background:var(--bg-color);color:var(--text-color);line-height:1.6;font-size:.95rem;min-height:100%;display:flex;flex-direction:column}
.container-fluid{flex:1 1 auto;display:flex;flex-direction:column;overflow:hidden;padding:0}

/* =====================================================================
   Header
   ===================================================================== */
.header{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;padding:.8rem 1.5rem;color:#fff;background:linear-gradient(135deg,var(--primary-color)0%,var(--primary-dark)100%);box-shadow:0 2px 5px rgba(0,0,0,.15);position:relative;z-index:10}
.header-left{display:flex;align-items:center}
.header-left h1{margin:0;font-size:1.4rem;font-weight:600;text-shadow:1px 1px 2px rgba(0,0,0,.1)}
.header-left p{margin:.1rem 0 0 .5rem;padding-left:.5rem;font-size:.85rem;opacity:.9;border-left:1px solid rgba(255,255,255,.3)}
.header-right{display:flex;align-items:center;gap:1rem}
#toggle-sidebar-btn{margin-right:.75rem;padding:.25rem .5rem;line-height:1;background:transparent;border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.8)}
#toggle-sidebar-btn:hover{background:rgba(255,255,255,.1);color:#fff}
#toggle-sidebar-btn .fa-chevron-left{display:none}
.sidebar-collapsed #toggle-sidebar-btn .fa-bars{display:none}
.sidebar-collapsed #toggle-sidebar-btn .fa-chevron-left{display:inline-block}
#api-provider{padding:.2rem .6rem;font-size:.8rem;color:rgba(255,255,255,.8);background:rgba(255,255,255,.1);border-radius:10px}
.status-item{display:flex;align-items:center;gap:.5rem;font-size:.8rem;color:rgba(255,255,255,.8)}
.status-indicator{width:9px;height:9px;border-radius:50%;flex-shrink:0;border:1px solid rgba(0,0,0,.2)}
.status-indicator.connected{background:#4caf50;box-shadow:0 0 5px rgba(76,175,80,.7);animation:pulseConnected 2s infinite}
.status-indicator.disconnected{background:#f44336;box-shadow:0 0 5px rgba(244,67,54,.7)}

/* =====================================================================
   Tabs Navigation
   ===================================================================== */
.tabs-container{display:flex;flex-shrink:0;overflow-x:auto;overflow-y:hidden;padding:0 1.5rem;background:#e9ecef;border-bottom:1px solid #dee2e6;box-shadow:inset 0 -2px 4px rgba(0,0,0,.04);-webkit-overflow-scrolling:touch}
.tab-item{display:inline-flex;align-items:center;gap:.4rem;padding:.7rem 1.2rem;margin-bottom:-1px;border:none;border-bottom:3px solid transparent;background:none;color:var(--light-text);font-weight:500;white-space:nowrap;cursor:pointer;transition:color .2s ease,border-color .2s ease}
.tab-item i{font-size:.9em;opacity:.8}
.tab-item:hover{color:var(--text-color)}
.tab-item.active{color:var(--primary-color);border-bottom-color:var(--primary-color)}
.tab-item.active i{opacity:1}

/* =====================================================================
   Content Wrappers
   ===================================================================== */
.tab-content-wrapper{flex:1 1 auto;display:flex;flex-direction:column;overflow:hidden;padding:1.5rem;min-height:0}
.tab-content{display:none;flex:1 1 auto;overflow:hidden}
.tab-content.active{display:flex}
.main-content{width:100%;flex:1 1 auto;display:flex;gap:1.5rem;min-height:0}

/* =====================================================================
   Sidebar (Left Panel)
   ===================================================================== */
.left-panel{width:30%;max-width:300px;min-width:200px;display:flex;flex-direction:column;overflow:hidden;padding:1rem;background:var(--card-bg);border:1px solid #e0e0e0;border-radius:var(--border-radius);box-shadow:var(--shadow);transition:width .3s,min-width .3s,padding .3s,opacity .3s,visibility .3s,margin-right .3s}
.main-content.sidebar-collapsed .left-panel{width:0;min-width:0;padding:0;margin-right:0;border:none;opacity:0;visibility:hidden}
.main-content.sidebar-collapsed{gap:0}
.panel-title{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;margin-bottom:1rem;padding-bottom:.6rem;font-size:1.1rem;font-weight:500;color:var(--primary-color);border-bottom:1px solid #ddd}
.panel-title i{margin-right:.5rem;font-size:.9em}
.history-list{flex:1 1 auto;list-style:none;overflow-y:auto;scrollbar-width:thin;scrollbar-color:#ccc transparent}
.history-list::-webkit-scrollbar{width:5px}
.history-list::-webkit-scrollbar-thumb{background:#ccc;border-radius:5px}
.left-panel>.btn{margin-top:1rem}

/* =====================================================================
   History Items
   ===================================================================== */
.history-item{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-bottom:.75rem;padding:.6rem;background:#f8f9fa;border:1px solid #eee;border-radius:6px;border-left:4px solid transparent;cursor:pointer;transition:var(--transition)}
.history-item:hover{background:#f1f3f5;transform:translateY(-1px);box-shadow:0 1px 3px rgba(0,0,0,.06)}
.history-item-content-wrapper{flex:1 1 auto;overflow:hidden;margin-right:.5rem;display:flex;flex-direction:column;gap:.2rem}
.history-item-content-wrapper div{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
#ss-history-list .history-item img{width:100%;max-width:100px;height:auto;margin-bottom:.3rem;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
#ss-history-list .history-item-text{font-size:.75rem;color:var(--light-text)}
.chat-history-item .history-item-content-wrapper>div:first-child,.voice-history-item .history-item-content-wrapper>div:first-child{font-weight:500;font-size:.85rem}
.chat-history-item .history-item-content-wrapper>div:last-child,.voice-history-item .history-item-content-wrapper>div:last-child{font-size:.7em;color:#6c757d}
.chat-history-item.active-session,.voice-history-item.active-session,#ss-history-list .history-item.active-screenshot-item{background:#e0e7ff!important;border-left-color:var(--primary-color);font-weight:500}
.history-item-actions{flex-shrink:0;display:flex;align-items:center;gap:.3rem}
.delete-history{width:26px;height:26px;font-size:13px;display:inline-flex;align-items:center;justify-content:center;border:none;border-radius:50%;background:transparent;color:#dc3545c2;cursor:pointer;opacity:.5;transition:var(--transition)}
.history-item:hover .delete-history{opacity:1}
.delete-history:hover{background:rgba(220,53,69,.1);color:#dc3545}

/* =====================================================================
   Right Panel Containers
   ===================================================================== */
.right-panel{flex:1 1 auto;display:flex;flex-direction:column;min-width:0}
.analysis-card,.chat-card,.voice-card{flex:1 1 auto;display:flex;flex-direction:column;overflow:hidden;padding:1rem;background:var(--card-bg);border:1px solid #e0e0e0;border-radius:var(--border-radius);box-shadow:var(--shadow)}

/* =====================================================================
   Chat / Analysis Area
   ===================================================================== */
.ai-analysis{flex:1 1 auto;padding:.75rem 1rem;font-size:.9rem;line-height:1.7;color:var(--text-color);background:#f8f9fa;border:1px solid #eee;border-radius:6px;overflow-y:auto;min-height:150px;scrollbar-width:thin;scrollbar-color:#ccc transparent}
.ai-analysis::-webkit-scrollbar{width:5px}
.ai-analysis::-webkit-scrollbar-thumb{background:#ccc;border-radius:5px}
.chat-messages{display:flex;flex-direction:column;gap:.5rem;padding-bottom:1rem}
.user-message,.ai-message,.error-message,.system-message,.ai-thinking{max-width:90%;margin-bottom:.5rem;padding:.8rem 1rem;font-size:.95rem;line-height:1.75;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05);word-wrap:break-word}
.user-message{margin-left:auto;background:#d1e7fd;color:#084298;border-bottom-right-radius:4px}
.ai-message{margin-right:auto;background:#e9ecef;color:#343a40;border-bottom-left-radius:4px}
.ai-message strong{color:var(--primary-dark)}
.error-message{background:#f8d7da;color:#842029;border:1px solid #f5c2c7;margin-right:auto}
.system-message{width:auto;margin:.5rem auto;font-size:.8em;font-style:italic;background:none;box-shadow:none;color:#6c757d;text-align:center}
.ai-thinking{display:inline-flex;align-items:center;width:fit-content;margin-right:auto;background:#e9ecef;color:#6c757d;font-style:italic;border-bottom-left-radius:4px}
.ai-thinking i{margin-right:.5em;animation:fa-spin 1.5s linear infinite}
.attached-file{display:inline-block;margin-top:.4rem;padding:.2rem .6rem;font-size:.8em;color:#495057;background:rgba(0,0,0,.05);border:1px solid rgba(0,0,0,.08);border-radius:4px;word-break:break-all}
.attached-file i{margin-right:.3em}

/* =====================================================================
   Chat Input & Controls
   ===================================================================== */
.chat-input-container{flex-shrink:0;display:flex;flex-direction:column;padding-top:.75rem;border-top:1px solid #eee}
#chat-chat-input{width:100%;margin-bottom:.5rem;padding:.75rem 1rem;font-size:.95rem;line-height:1.5;background:#fff;border:1px solid #ccc;border-radius:6px;resize:none;outline:none;transition:var(--transition)}
#chat-chat-input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(var(--primary-color-rgb),.25)}
.chat-controls{display:flex;align-items:stretch}
.file-upload-label{display:inline-flex;align-items:center;justify-content:center;height:42px;padding:0 1rem;background:#f0f0f0;border:1px solid #ccc;border-right:none;border-radius:6px 0 0 6px;font-size:1.1rem;color:#555;cursor:pointer;transition:var(--transition)}
.file-upload-label:hover{background:#e0e0e0;color:#333}
#chat-send-chat{flex-shrink:0;height:42px;padding:0 1.2rem;font-size:1rem;border-radius:0 6px 6px 0}
#chat-send-chat i{font-size:1.1rem}
#chat-upload-preview{max-height:80px;overflow-y:auto;margin-bottom:.5rem}
.preview-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:.3rem;padding:.4rem .6rem;font-size:.8rem;line-height:1.3;background:#e9ecef;border:1px solid #dee2e6;border-radius:4px}
.file-info{display:flex;align-items:center;overflow:hidden;margin-right:.5rem;color:#495057;white-space:nowrap;text-overflow:ellipsis}
.file-info i{margin-right:.4rem;color:#6c757d;font-size:.9em}
.remove-file{flex-shrink:0;padding:0 .2rem;font-size:1.2em;background:none;border:none;color:#6c757d;cursor:pointer;opacity:.7;transition:var(--transition)}
.remove-file:hover{color:#dc3545;opacity:1}

/* Voice Controls */
.voice-controls{flex-shrink:0;display:flex;justify-content:center;gap:1rem;padding-top:1rem;border-top:1px solid #eee}
#voice-start-recording i,#voice-stop-recording i{margin-right:.5rem}

/* =====================================================================
   Overlay / Cropper
   ===================================================================== */
.overlay{position:fixed;inset:0;display:none;justify-content:center;align-items:center;padding:1rem;background:rgba(0,0,0,.85);z-index:1000;animation:fadeIn .3s forwards}
.overlay.hide{animation:fadeOut .3s forwards}
.overlay-content{position:relative;display:flex;flex-direction:column;width:95%;max-width:1000px;max-height:95vh;overflow:hidden;background:var(--card-bg);border-radius:var(--border-radius);box-shadow:0 5px 20px rgba(0,0,0,.4)}
.close-btn{position:absolute;top:.5rem;right:.5rem;width:30px;height:30px;font-size:1.2rem;line-height:30px;text-align:center;color:#fff;background:rgba(0,0,0,.4);border:none;border-radius:50%;cursor:pointer;transition:var(--transition);z-index:1010}
.close-btn:hover{background:rgba(0,0,0,.7)}
.image-container{position:relative;display:flex;align-items:center;justify-content:center;flex:1 1 auto;min-height:200px;overflow:auto;background:#333}
#overlay-image{display:block;max-width:100%;max-height:calc(95vh - 180px);object-fit:contain;cursor:crosshair;user-select:none;-webkit-user-drag:none}
.selection-box{position:absolute;border:2px dashed #f0f0f0;background:rgba(var(--primary-color-rgb),.2);box-shadow:0 0 0 9999px rgba(0,0,0,.6);pointer-events:auto}
.resize-handle{position:absolute;bottom:-15px;right:-15px;width:30px;height:30px;border-radius:50%;background:rgba(var(--primary-color-rgb),.5);cursor:nwse-resize;pointer-events:auto;z-index:1000}
.overlay-controls{flex-shrink:0;padding:1rem;background:#f8f9fa;border-top:1px solid #e0e0e0}
.crop-info{margin-bottom:.75rem;font-size:.85rem;color:#555;text-align:center;min-height:1.2em}
.prompt-container{margin-bottom:1rem}
.prompt-container label{display:block;margin-bottom:.3rem;font-size:.9rem;font-weight:500}
.prompt-container input{width:100%;padding:.6rem;font-family:var(--font-family-sans-serif);border:1px solid #ccc;border-radius:4px}
.prompt-container input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(var(--primary-color-rgb),.15);outline:none}
.buttons{display:flex;justify-content:flex-end;gap:.75rem}

/* =====================================================================
   Utility Buttons
   ===================================================================== */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.6rem 1.2rem;font-size:.9rem;font-weight:500;line-height:1.5;white-space:nowrap;border:none;border-radius:6px;cursor:pointer;transition:var(--transition);font-family:var(--font-family-sans-serif)}
.btn i{line-height:1}
.btn-primary{color:#fff;background:linear-gradient(135deg,var(--primary-color)0%,var(--primary-dark)100%);box-shadow:0 2px 4px rgba(0,0,0,.1)}
.btn-primary:hover{background:linear-gradient(135deg,var(--primary-dark)0%,var(--primary-color)100%);box-shadow:0 4px 8px rgba(0,0,0,.15);transform:translateY(-1px)}
.btn-secondary{color:#fff;background:#6c757d;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.btn-secondary:hover{background:#5a6268;box-shadow:0 4px 8px rgba(0,0,0,.15);transform:translateY(-1px)}
.btn-danger{color:#fff;background:#dc3545;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.btn-danger:hover{background:#c82333;box-shadow:0 4px 8px rgba(0,0,0,.15);transform:translateY(-1px)}
.btn-sm{padding:.25rem .5rem;font-size:.8rem;border-radius:4px;gap:.25rem}
.btn-xs{padding:.15rem .4rem;font-size:.75rem;border-radius:3px;line-height:1.2}
.btn-outline-primary{color:var(--primary-color);background:transparent;border:1px solid var(--primary-color)}
.btn-outline-primary:hover{color:#fff;background:var(--primary-color);border-color:var(--primary-color)}
.btn-outline-secondary{color:#6c757d;background:transparent;border:1px solid #6c757d}
.btn-outline-secondary:hover{color:#fff;background:#6c757d;border-color:#6c757d}
button:disabled{opacity:.65;cursor:not-allowed;transform:none!important;box-shadow:none!important}

/* =====================================================================
   Markdown Content / Code Blocks
   ===================================================================== */
.message-content{font-size:inherit;line-height:1.75;color:inherit;text-align:left;word-wrap:break-word}
.message-content h1{font-size:1.6em}
.message-content h2{font-size:1.4em}
.message-content h3{font-size:1.2em}
.message-content h4{font-size:1.1em}
.message-content h5{font-size:1em;font-weight:bold}
.message-content h6{font-size:.9em;font-weight:bold;color:var(--light-text)}
.message-content p{margin-bottom:.8em}
.message-content ul,.message-content ol{margin-bottom:.8em;padding-left:2em}
.message-content code:not(pre code){font-family:var(--font-family-monospace);background:rgba(0,0,0,.06);color:#c7254e;padding:.2em .4em;font-size:.85em;border-radius:3px}
.message-content pre{position:relative;margin:.8em 0;padding:1em;font-size:.9em;font-family:var(--font-family-monospace);border:1px solid #444;border-radius:var(--border-radius);overflow-x:auto}
.message-content pre code{display:block;background:transparent!important;white-space:pre}
.copy-code-button{position:absolute;top:.3em;right:.3em;font-size:.8em;padding:.25em .5em;color:#abb2bf;background:#454c54;border:1px solid #3a3f44;border-radius:4px;cursor:pointer;opacity:0;transition:opacity .2s,background .2s;z-index:10}
.message-content pre:hover .copy-code-button{opacity:.7}
.copy-code-button:hover{opacity:1;background:#528bff;color:#fff}
.copy-code-button.copied{background:#28a745;color:#fff;opacity:1}
.copy-code-button.copy-failed{background:#dc3545;color:#fff;opacity:1}
.message-content table{width:auto;max-width:100%;border:1px solid #d0d7de;border-collapse:collapse;overflow-x:auto;display:block;margin:1em 0;font-size:.9em}
.message-content th,.message-content td{padding:8px 12px;border:1px solid #d0d7de;text-align:left}
.message-content th{background:#f6f8fa;font-weight:600}
.message-content tr:nth-child(even){background:#fdfdfd}
.message-content blockquote{margin:.8em 0;padding:.5em 1em;color:#586069;background:#f8f9fa;border-left:.25em solid #d0d7de}

/* LaTeX / KaTeX */
.message-content .katex{font-size:1em;line-height:normal;vertical-align:baseline;text-rendering:optimizeLegibility;text-align:initial}
.message-content .katex-display{display:block;margin:1em auto;padding:.5em;overflow-x:auto;text-align:center;line-height:normal;background:rgba(233,236,239,.6);border-radius:4px;max-width:100%;box-sizing:border-box;font-size:1.05em}
.message-content .katex-display::-webkit-scrollbar{height:6px;background:transparent}
.message-content .katex-display::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}
.message-content .katex-display::-webkit-scrollbar-thumb:hover{background:#aaa}
.message-content .katex-display{scrollbar-width:thin;scrollbar-color:#ccc transparent}

/* =====================================================================
   Responsive Breakpoints
   ===================================================================== */
@media(max-width:992px){.ai-message,.user-message{max-width:95%}}
@media(max-width:768px){body{font-size:.9rem}.left-panel{width:100%!important;max-width:none!important;min-width:0!important;margin-right:0!important;margin-bottom:1rem!important}.main-content{flex-direction:column!important}.main-content.sidebar-collapsed .left-panel{height:0;padding:0;margin-bottom:0;border:none}}
@media(max-width:480px){.ai-message,.user-message{max-width:98%}.message-content .katex{font-size:.9em}.message-content .katex-display{font-size:.95em}}

/* =====================================================================
   Streaming Toggle / Chat Buttons Cluster
   ===================================================================== */
.streaming-toggle{display:flex;align-items:center;margin-right:10px;font-size:.9em;color:var(--light-text)}
.streaming-toggle input[type="checkbox"]{margin-right:5px;transform:scale(.9)}
.streaming-toggle label{margin:0;font-weight:400}
.chat-buttons{display:flex;align-items:center;justify-content:flex-end;flex-grow:1;gap:.5rem}

/* =====================================================================
   Keyframes
   ===================================================================== */
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
@keyframes fa-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes pulseConnected{0%{box-shadow:0 0 3px rgba(76,175,80,.4)}50%{box-shadow:0 0 8px rgba(76,175,80,.8)}100%{box-shadow:0 0 3px rgba(76,175,80,.4)}}
